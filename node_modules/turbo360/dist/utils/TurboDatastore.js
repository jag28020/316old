var Promise=require("bluebird"),superagent=require("superagent"),TurboDatastore=function(e){var r=e,t=function(t,i){return null==i&&(i={}),i.site=r.site_id,new Promise(function(r,o){if(null==i.site)return void o(new Error("Please Set Your TURBO_APP_ID"));if(0==i.site.length)return void o(new Error("Please Set Your TURBO_APP_ID"));var n=t.toLowerCase().trim(),u={Accept:"application/json"};u[e.turbo_app_header]=e.site_id,superagent.get(e.base_url+"/api/"+n).query(i).set(u).end(function(e,t){if(e)return void o(e);if("fail"==t.body.confirmation)return void o(new Error(t.body.message));var i=t.body.results;r(i)})})},i=function(r,t){return new Promise(function(i,o){if(null==e.site_id)return void o(new Error("Please Set Your TURBO_APP_ID"));if(e.site_id.length<20)return void o(new Error("Please Set Your TURBO_APP_ID"));var n={Accept:"application/json"};n[e.turbo_app_header]=e.site_id;var u=r.toLowerCase().trim();superagent.get(e.base_url+"/api/"+u+"/"+t).query(null).set(n).end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var t=r.body.result;i(t)})})},o=function(r,t){return new Promise(function(i,o){if(null==e.site_id)return void o(new Error("Please Set Your TURBO_APP_ID"));if(e.site_id.length<20)return void o(new Error("Please Set Your TURBO_APP_ID"));if(null==t)return void o(new Error("Post parameters required."));var n=r.toLowerCase().trim(),u={Accept:"application/json"};u[e.turbo_app_header]=e.site_id,t.site=e.site_id,superagent.post(e.base_url+"/api/"+n).send(t).set(u).end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var t=r.body.result||r.body.results;i(t)})})},n=function(r,t,i){return new Promise(function(o,n){if(null==e.site_id)return void n(new Error("Please Set Your TURBO_APP_ID"));if(e.site_id.length<20)return void n(new Error("Please Set Your TURBO_APP_ID"));if(null==i)return void n(new Error("Updated parameters required."));var u=r.toLowerCase().trim(),s={Accept:"application/json"};s[e.turbo_app_header]=e.site_id,superagent.put(e.base_url+"/api/"+u+"/"+t).send(i).set(s).end(function(e,r){if(e)return void n(e);if("fail"==r.body.confirmation)return void n(new Error(r.body.message));var t=r.body.result||r.body.results;o(t)})})},u=function(r,t){return new Promise(function(i,o){if(null==e.site_id)return void o(new Error("Please Set Your TURBO_APP_ID"));if(e.site_id.length<20)return void o(new Error("Please Set Your TURBO_APP_ID"));var n=r.toLowerCase().trim(),u={Accept:"application/json"};u[e.turbo_app_header]=e.site_id,superagent.delete(e.base_url+"/api/"+n+"/"+t).set(u).end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var t=r.body.result||r.body.results;i(t)})})};return{fetch:t,fetchOne:i,create:o,update:function(r,t,i){return new Promise(function(o,n){if(null==e.site_id)return void n(new Error("Please Set Your TURBO_APP_ID"));if(e.site_id.length<20)return void n(new Error("Please Set Your TURBO_APP_ID"));if(null==i)return void n(new Error("Post parameters required."));Object.keys(i).forEach(function(e,r){var o=i[e];t[e]=o});var u=r.toLowerCase().trim(),s={Accept:"application/json"};s[e.turbo_app_header]=e.site_id,superagent.put(e.base_url+"/api/"+u+"/"+t.id).send(t).set(s).end(function(e,r){if(e)return void n(e);if("fail"==r.body.confirmation)return void n(new Error(r.body.message));var t=r.body.result||r.body.results;o(t)})})},remove:function(r,t){return new Promise(function(i,o){if(null==e.site_id)return void o(new Error("Please Set Your TURBO_APP_ID"));if(e.site_id.length<20)return void o(new Error("Please Set Your TURBO_APP_ID"));var n=r.toLowerCase().trim(),u={Accept:"application/json"};u[e.turbo_app_header]=e.site_id,superagent.delete(e.base_url+"/api/"+n+"/"+t.id).set(u).end(function(e,r){if(e)return void o(e);if("fail"==r.body.confirmation)return void o(new Error(r.body.message));var t=r.body.result||r.body.results;i(t)})})},updateEntity:n,removeEntity:u}};module.exports=TurboDatastore;